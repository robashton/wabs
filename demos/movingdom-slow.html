<html>
  <body>
    <h1 id="fps"></h1>
    <div id="container">

    </div>
  </body>
  <script type="text/javascript">
    var particleCount = 100
    var width = 800
    var height = 600 
    var averageFrameTime = 0

    function setupParticles() {
      var container = document.getElementById('container')
      container.style.width = width + 'px'
      container.style.height = height + 'px'
      container.style.overflow = 'hidden'
      container.style.border = '1px solid #FFF'

      for(var i = 0 ; i < particleCount; i++) {
        var child = document.createElement('div')
        child.style.position = 'absolute'
        child.style.left = Math.random() * width + 'px'
        child.style.top = Math.random() * height + 'px'
        child.style.width = '5px'
        child.style.height = '5px'
        child.velx = (Math.random() * 20.0) - 10.0
        child.vely = (Math.random() * 20.0) - 10.0
        child.style['background-color'] = '#000'
        container.appendChild(child)
      }
    }

    function update() {
      var start = new Date()
      var container = document.getElementById('container') 
      var fps = document.getElementById('fps')
      
      for(var i = 0 ; i < container.children.length; i++) {
        var child = container.children[i]
        child.style.left  = child.offsetLeft + child.velx
        child.style.top = child.offsetTop + child.vely
      }
      var end = new Date()
      averageFrameTime += (end - start)
      averageFrameTime /= 2.0
      fps.textContent = parseInt(1000 / averageFrameTime, 10) + 'fps'
      setTimeout(update, 0)
    }

    setupParticles()
    update()
  </script>
</html>
